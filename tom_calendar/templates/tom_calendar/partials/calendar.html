<style>
  .cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
  }
  .cal-day {
    min-height: 110px;
    background-color: var(--light);
    color: var(--secondary);
  }
  .cal-day.is-current-month {
    background-color: transparent;
    color: inherit;
  }
  .cal-day:hover {
    background-color: rgba(0, 0, 0, .06);
  }
  .cal-day.is-current-month:hover {
    background-color: rgba(0, 0, 0, .04);
  }
  .day-num {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.6rem;
    height: 1.6rem;
    font-size: 0.80rem;
    font-weight: 500;
    border-radius: 50%;
    margin-bottom: 0.15rem;
  }
  .cal-day.is-current-month.today .day-num {
    background-color: var(--primary);
    color: var(--white);
    font-weight: 700;
  }
  .moon-phase {
    font-size: 0.9rem;
    cursor: default;
    float: right;
  }
  .cal-event {
    font-size: 0.75rem;
    line-height: 1.3;
    cursor: pointer;
  }
  .cal-event a {
    color: inherit;
  }
  .cal-event-timed {
    display: flex;
    align-items: center;
    gap: 2px;
  }
  .cal-event-timed .cal-event-title {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .cal-event-timed .cal-event-bullet {
    flex-shrink: 0;
    opacity: 0.5;
  }
  .cal-event-timed .cal-event-time {
    flex-shrink: 0;
    white-space: nowrap;
    opacity: 0.55;
    font-size: 0.68rem;
  }
  .cal-event-all-day {
    display: block;
    border-radius: 3px;
    padding: 1px 5px;
    margin-bottom: 2px;
    color: #fff !important;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    cursor: pointer;
  }
  .cal-event-all-day a {
    color: #fff !important;
    text-decoration: none;
  }
  .cal-event-all-day a:hover {
    text-decoration: underline;
  }
</style>

<div id="calendar-partial">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-outline-secondary btn-sm"
            hx-get="{% url 'calendar:calendar' %}?month={{ prev_month }}&year={{ prev_year }}"
            hx-target="#calendar-partial"
            hx-swap="outerHTML">
      &laquo; Prev
    </button>
    <h4 class="mb-0">{{ month_name }}</h4>
    <button class="btn btn-outline-secondary btn-sm"
            hx-get="{% url 'calendar:calendar' %}?month={{ next_month }}&year={{ next_year }}"
            hx-target="#calendar-partial"
            hx-swap="outerHTML">
      Next &raquo;
    </button>
  </div>

  <div class="cal-grid border-top border-left">
    {% for name in day_names %}
      <div class="cal-day-header text-center bg-light font-weight-bold text-secondary border-right border-bottom p-2">{{ name }}</div>
    {% endfor %}

    {% for week in weeks %}
      {% for day in week %}
        <div class="cal-day{% if day.date.month == month %} is-current-month{% endif %}{% if day.date == today %} today{% endif %} border-right border-bottom p-1"
             hx-get="{% url 'calendar:create-event' %}?date={{ day.date }}"
             hx-target="#cal-modal-body"
             hx-on::after-request="$('#cal-modal').modal('show');"
        >
          <span class="day-num">{{ day.date.day }}</span>
          <span class="moon-phase" title="{% widthratio day.moon.illumination 1 100 %}% illuminated">{{ day.moon.emoji }}</span>
          {% for event in day.all_day_events %}
            <div class="cal-event cal-event-all-day" style="background-color: {{ event.color }};"
                 hx-get="{% url 'calendar:update-event' event.id %}"
                 hx-target="#cal-modal-body"
                 hx-on::after-request="$('#cal-modal').modal('show');"
                 hx-on:click="event.stopPropagation()"
            >
              {% if event.url %}
                <a href="{{ event.url }}">{{ event.title|truncatechars:22 }}</a>
              {% else %}
                {{ event.title|truncatechars:22 }}
              {% endif %}
            </div>
          {% endfor %}
          {% for event in day.events %}
            <div class="cal-event cal-event-timed"
                 hx-get="{% url 'calendar:update-event' event.id %}"
                 hx-target="#cal-modal-body"
                 hx-on::after-request="$('#cal-modal').modal('show');"
                 hx-on:click="event.stopPropagation()"
            >
              <span class="cal-event-bullet">â€¢</span>
              <span class="cal-event-title">
                {% if event.url %}
                  <a href="{{ event.url }}">{{ event.title|truncatechars:20 }}</a>
                {% else %}
                  {{ event.title|truncatechars:20 }}
                {% endif %}
              </span>
              <span class="cal-event-time">{{ event.start_time|time:"H:i" }}</span>
            </div>
          {% endfor %}
        </div>
      {% endfor %}
    {% endfor %}
  </div>
</div>
